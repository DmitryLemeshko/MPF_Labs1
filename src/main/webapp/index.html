<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <title>Відгуки</title>
</head>
<body>
<h2>Відгуки</h2>

<form id="f" style="margin-bottom:1rem">
    <label for="author">Ваше ім'я:</label>
    <input id="author" name="author" required maxlength="64">

    <label for="text">Ваш відгук:</label>
    <input id="text" name="text" required maxlength="1000" style="width:50%">

    <button>Надіслати</button>
</form>

<ul id="list"></ul>

<script>
    async function load() {
        const r = await fetch('/comments');
        const a = await r.json();
        const ul = document.getElementById('list');
        ul.innerHTML = '';
        if (!a.length) {
            ul.innerHTML = '<li>Ще немає відгуків</li>';
            return;
        }
        a.forEach(c => {
            const li = document.createElement('li');
            li.textContent = `${c.author}: ${c.text}`;
            ul.appendChild(li);
        });
    }

    document.getElementById('f').addEventListener('submit', async e => {
        e.preventDefault();
        const fd = new FormData(e.target);
        const r = await fetch('/comments', { method: 'POST', body: fd });
        if (r.ok) {
            e.target.reset();
            await load();
        } else {
            alert('Помилка: ' + (await r.text()));
        }
    });

    load();
</script>
</body>
</html>
